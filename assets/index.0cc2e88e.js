var DA=Object.defineProperty;var zA=(a,A,t)=>A in a?DA(a,A,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[A]=t;var o=(a,A,t)=>(zA(a,typeof A!="symbol"?A+"":A,t),t);(function(){const A=document.createElement("link").relList;if(A&&A.supports&&A.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))e(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const r of s.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&e(r)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerpolicy&&(s.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?s.credentials="include":i.crossorigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function e(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();const MA=1080,UA=1920,S=1e3/60,G={seconds:60*S,half:30*S,thirds:20*S,lengths:15*S,sixth:10*S,five:5*S,three:3*S,one:1*S},hA="data:image/png;base64,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AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAJv710cAu/XkIwDjH9id3ywAwAQA2OH4NwEACwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgHV+AKbwnWgay4eEAAAAAElFTkSuQmCC",vA=a=>{let A,t=0;function e(i){let s=i-(t||i);t=i,s=Math.max(Math.min(s,16),4),a(s),A=requestAnimationFrame(e)}return A=requestAnimationFrame(e),()=>{cancelAnimationFrame(A)}};class RA{constructor(A,t,e){o(this,"$canvas");o(this,"gl");this.$wrap=A,this.width=t,this.height=e,this.$canvas=document.createElement("canvas"),this.$canvas.width=t,this.$canvas.height=e,A.appendChild(this.$canvas);let i=this.$canvas.getContext("webgl2",{alpha:!0,antialias:!1});if(i===null)throw"No webgl2";this.gl=i}}const PA=16711680,FA=65280,IA=255;function kA(a){let A=(a&PA)>>16,t=(a&FA)>>8,e=a&IA;return[A,t,e].map(i=>i/255)}class LA{constructor(A,t,e){this.uniformData=A,this.attributeData=t,this.program=e}}function SA(a,A,t){const e=mA(a,a.VERTEX_SHADER,A),i=mA(a,a.FRAGMENT_SHADER,t),s=a.createProgram();a.attachShader(s,e),a.attachShader(s,i),a.linkProgram(s);let r=YA(a,s),n=QA(a,s);const h=Object.keys(r);for(let l=0;l<h.length;l++)r[h[l]].location=l,a.bindAttribLocation(s,l,h[l]);a.linkProgram(s),a.deleteShader(e),a.deleteShader(i);for(let l in n)n[l],n[l].location=a.getUniformLocation(s,l);return new LA(n,r,s)}function QA(a,A){const t={},e=a.getProgramParameter(A,a.ACTIVE_UNIFORMS);for(let i=0;i<e;i++){const s=a.getActiveUniform(A,i),r={name:s.name,location:-1,index:i};t[s.name]=r}return t}function YA(a,A){const t={},e=a.getProgramParameter(A,a.ACTIVE_ATTRIBUTES);for(let i=0;i<e;i++){const s=a.getActiveAttrib(A,i);if(s.name.indexOf("gl_")===0)continue;const r={tpe:"tpe",name:s.name,size:0,location:i};t[s.name]=r}return t}function mA(a,A,t){const e=a.createShader(A);return a.shaderSource(e,t),a.compileShader(e),e}class OA{constructor(A,t){o(this,"glOnce",(A={})=>{let{gl:t}=this;if(!t)return;let{color:e}=A;t.viewport(0,0,this.width,this.height);let[i,s,r]=kA(e||0);t.clearColor(i,s,r,1),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),t.enable(t.DEPTH_TEST),t.depthFunc(t.LEQUAL)});o(this,"glProgram",(A,t,e)=>{let{gl:i}=this,{program:s,uniformData:r,attributeData:n}=SA(i,A,t),h=i.createVertexArray();i.bindVertexArray(h);let l=i.createBuffer();i.bindBuffer(i.ARRAY_BUFFER,l),i.bufferData(i.ARRAY_BUFFER,e*10*4,i.DYNAMIC_DRAW);let u=i.createBuffer();i.bindBuffer(i.ELEMENT_ARRAY_BUFFER,u),i.bufferData(i.ELEMENT_ARRAY_BUFFER,e*3*4,i.DYNAMIC_DRAW);let c=3*4+2*4+3*4+2*4,d=n.aVertexPosition.location;i.enableVertexAttribArray(d),i.vertexAttribPointer(d,3,i.FLOAT,!1,c,0);let m=n.aTextureCoord.location;i.enableVertexAttribArray(m),i.vertexAttribPointer(m,2,i.FLOAT,!1,c,3*4);let _=n.aTint.location;i.enableVertexAttribArray(_),i.vertexAttribPointer(_,3,i.FLOAT,!1,c,3*4+2*4);let f=n.aType.location;return i.enableVertexAttribArray(f),i.vertexAttribPointer(f,2,i.FLOAT,!1,c,3*4+2*4+3*4),i.bindVertexArray(null),{program:s,uniformData:r,indexBuffer:u,attributeBuffer:l,vao:h}});this.canvas=A,this.camera=t}get gl(){return this.canvas.gl}get width(){return this.canvas.width}get height(){return this.canvas.height}get u_matrix(){return this.camera.vp_matrix}glTexture(A){let{gl:t}=this,e=t.createTexture();return t.activeTexture(t.TEXTURE0+A),t.bindTexture(t.TEXTURE_2D,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array([0,0,255,255])),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),{glTexture:e}}glUseTexture(A,t,e){let{gl:i}=this;i.activeTexture(i.TEXTURE0+e),i.bindTexture(i.TEXTURE_2D,A),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,t.width,t.height,0,i.RGBA,i.UNSIGNED_BYTE,t)}glUse(A,t){let{gl:e}=this;e.useProgram(A),t.uSampler?(e.uniform1i(t.uSampler.location,0),e.uniform1i(t.uSampler2.location,1)):e.uniform1i(t.uSampler3.location,2),e.uniformMatrix4fv(t.u_matrix.location,!1,this.u_matrix.out)}glUniformUpdate(A,t){let{gl:e}=this;!A.u_blend||(e.uniform1f(A.u_blend.location,t[0]),e.uniform1f(A.u_mix.location,t[1]),e.uniform1f(A.u_hmix.location,t[2]),e.uniform1f(A.u_hhmix.location,t[3]))}glAttribUpdate(A,t){let{gl:e}=this;e.bindBuffer(e.ARRAY_BUFFER,A),e.bufferSubData(e.ARRAY_BUFFER,0,t,0)}glIndexUpdate(A,t){let{gl:e}=this;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,A),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t,0)}glClear(){let{gl:A}=this;A.clear(A.COLOR_BUFFER_BIT|A.DEPTH_BUFFER_BIT)}glDraw(A,t){let{gl:e}=this;e.bindVertexArray(t),e.drawElements(e.TRIANGLES,A,e.UNSIGNED_SHORT,0)}}var fA=`#version 300 es
in vec3 aTint;
in vec3 aType;
in vec4 aVertexPosition;
in vec2 aTextureCoord;
uniform mat4 u_matrix;
out vec3 vType;
out vec3 vTint;
out vec2 vTextureCoord;
out vec3 vVertexCoord;

void main() {
  gl_Position = u_matrix * aVertexPosition;
  vTextureCoord = aTextureCoord;
  vVertexCoord = gl_Position.xyz;
  vTint = aTint;
  vType = aType;
}`,GA=`#version 300 es
precision highp float;
in vec2 vTextureCoord;
in vec3 vVertexCoord;
in vec3 vTint;
in vec3 vType;
out vec4 outColor;

uniform sampler2D uSampler;
uniform sampler2D uSampler2;

uniform float u_blend;
uniform float u_mix;
uniform float u_hmix;
uniform float u_hhmix;

void main() {

  vec2 p = vTextureCoord;

  vec4 shade = texture(uSampler, vTextureCoord);
  vec4 shade2 = texture(uSampler2, vTextureCoord);

  vec4 col = vec4(0.0, 0.0, 0.0, shade.a);

  

  
  
  
  

  float blend = u_blend;
  float _mix = u_mix;
  float _hmix = _mix * u_hmix;
  float _hhmix = _hmix * u_hhmix;

  if (shade.r > blend) {
    col.r = (_hmix - (_hmix - shade2.r) * (_hmix - _mix * (shade.r - _hhmix)));
  } else {
    col.r = shade2.r * (_mix * shade.r); 
  }

  if (shade.g > blend) {
    col.g = (_hmix - (_hmix - shade2.g) * (_hmix - _mix * (shade.g - _hhmix)));
  } else {
    col.g = shade2.g * (_mix * shade.g);
  }

  if (shade.b > blend) {
    col.b = (_hmix - (_hmix - shade2.b) * (_hmix - _mix * (shade.b - _hhmix)));
  } else {
    col.b = shade2.b * (_mix * shade.b) ;
  }

  col.rgb *= col.a;
  col.rgb *= vTint;
  col.a += vType.z;

  outColor =col;
 
}`,NA=`#version 300 es
precision highp float;
in vec2 vTextureCoord;
in vec3 vVertexCoord;
in vec3 vTint;
in vec3 vType;
out vec4 outColor;

uniform sampler2D uSampler3;

void main() {

  vec2 p = vTextureCoord;
  vec4 col = texture(uSampler3, vTextureCoord);

  col.rgb *= vTint;
  col.a += vType.z;

  outColor = vec4(col.rgb * col.a, col.a);
}`;const K=class{constructor(A){this.vertices=A}static get unit(){return K.make(0,0,0,1,1)}get vertexData(){return new Float32Array(this.vertices.flatMap(A=>A.vs))}get indices(){return new Uint16Array([1,0,3,1,3,2])}transform(A){return new K(this.vertices.map(t=>A.mVec3(t)))}};let $=K;o($,"make",(A,t,e,i,s)=>new K([C.make(A,t-s,e),C.make(A+i,t-s,e),C.make(A+i,t,e),C.make(A,t,e)]));const k=class{constructor(A,t,e){o(this,"x");o(this,"y");o(this,"z");this.x=A,this.y=t,this.z=e}static get unit(){return new k(1,1,1)}static get zero(){return new k(0,0,0)}static get down(){return new k(0,1,0)}static get up(){return new k(0,-1,0)}static get right(){return new k(1,0,0)}static get left(){return new k(-1,0,0)}get vs(){return[this.x,this.y,this.z]}get mul_inverse(){return new k(1/this.x,1/this.y,1/this.z)}get inverse(){return new k(-this.x,-this.y,-this.z)}get half(){return new k(this.x/2,this.y/2,this.z/2)}get length_squared(){return this.x*this.x+this.y*this.y+this.z*this.z}get length(){return Math.sqrt(this.length_squared)}get normalize(){return this.length===0?k.zero:this.scale(1/this.length)}get perpendicular(){return new k(-this.y,this.x,this.z)}get clone(){return new k(this.x,this.y,this.z)}dot(A){return this.x*A.x+this.y*A.y+this.z*A.z}cross(A){return k.make(this.y*A.z-this.z*A.y,this.z*A.x-this.x*A.z,this.x*A.y-this.y*A.x)}distance(A){return this.sub(A).length}scale(A){let{clone:t}=this;return t.scale_in(A)}scale_in(A){return this.x*=A,this.y*=A,this.z*=A,this}add(A){let{clone:t}=this;return t.add_in(A)}add_in(A){return this.x+=A.x,this.y+=A.y,this.z+=A.z,this}sub(A){let{clone:t}=this;return t.sub_in(A)}sub_in(A){return this.x-=A.x,this.y-=A.y,this.z-=A.z,this}mul(A){let{clone:t}=this;return t.mul_in(A)}mul_in(A){return this.x*=A.x,this.y*=A.y,this.z*=A.z,this}div(A){let{clone:t}=this;return t.div_in(A)}div_in(A){return this.x/=A.x,this.y/=A.y,this.z/=A.z,this}set_in(A,t=this.y,e=this.z){return this.x=A,this.y=t,this.z=e,this}copy_in(A){return this.set_in(A.x,A.y,A.z)}};let C=k;o(C,"make",(A,t,e)=>new k(A,t,e));const T=class{constructor(A){this.out=A}static get identity(){return new T([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}get transpose(){let A=this.out;return T.make([A[0],A[4],A[8],A[12],A[1],A[5],A[9],A[13],A[2],A[6],A[10],A[14],A[3],A[7],A[11],A[15]])}get inverse(){let[A,t,e,i,s,r,n,h,l,u,c,d,m,_,f,y]=this.out,[p,v,E,z,M,B,U,b,R,P,F,I]=[A*r-t*s,A*n-e*s,A*h-i*s,t*n-e*r,t*h-i*r,e*h-i*n,l*_-u*m,l*f-c*m,l*y-d*m,u*f-c*_,u*y-d*_,c*y-d*f],w=p*I-v*F+E*P+z*R-M*b+B*U;if(!w)return;w=1/w;let N=[(r*I-n*F+h*P)*w,(e*F-t*I-i*P)*w,(_*B-f*M+y*z)*w,(c*M-u*B-d*z)*w,(n*R-s*I-h*b)*w,(A*I-e*R+i*b)*w,(f*E-m*B-y*v)*w,(l*B-c*E+d*v)*w,(s*F-r*R+h*U)*w,(t*R-A*F-i*U)*w,(m*M-_*E+y*p)*w,(u*E-l*M-d*p)*w,(r*b-s*P-n*U)*w,(A*P-t*b+e*U)*w,(_*v-m*z-f*p)*w,(l*z-u*v+c*p)*w];return new T(N)}get clone(){return T.make(this.out.slice(0))}rotate(A){return this.mul(T.from_quat(A))}scale(A){let t=this.out;return T.make([t[0]*A.x,t[1]*A.x,t[2]*A.x,t[3]*A.x,t[4]*A.y,t[5]*A.y,t[6]*A.y,t[7]*A.y,t[8]*A.z,t[9]*A.z,t[10]*A.z,t[11]*A.z,t[12],t[13],t[14],t[15]])}translate(A){let{clone:t}=this;return t.translate_in(A)}translate_in(A){let t=this.out;return t[12]=t[0]*A.x+t[4]*A.y+t[8]*A.z+t[12],t[13]=t[1]*A.x+t[5]*A.y+t[9]*A.z+t[13],t[14]=t[2]*A.x+t[6]*A.y+t[10]*A.z+t[14],t[15]=t[3]*A.x+t[7]*A.y+t[11]*A.z+t[15],this}mul(A){let{clone:t}=this;return t.mul_in(A)}mul_in(A){let t=this.out,[e,i,s,r,n,h,l,u,c,d,m,_,f,y,p,v]=t,[E,z,M,B,U,b,R,P,F,I,w,N,V,W,J,Z]=A.out;return t[0]=E*e+z*n+M*c+B*f,t[1]=E*i+z*h+M*d+B*y,t[2]=E*s+z*l+M*m+B*p,t[3]=E*r+z*u+M*_+B*v,t[4]=U*e+b*n+R*c+P*f,t[5]=U*i+b*h+R*d+P*y,t[6]=U*s+b*l+R*m+P*p,t[7]=U*r+b*u+R*_+P*v,t[8]=F*e+I*n+w*c+N*f,t[9]=F*i+I*h+w*d+N*y,t[10]=F*s+I*l+w*m+N*p,t[11]=F*r+I*u+w*_+N*v,t[12]=V*e+W*n+J*c+Z*f,t[13]=V*i+W*h+J*d+Z*y,t[14]=V*s+W*l+J*m+Z*p,t[15]=V*r+W*u+J*_+Z*v,this}mVec3(A){let t=this.out,[e,i,s]=A.vs,r=t[3]*e+t[7]*i+t[11]*s+t[15];return r=r||1,C.make((t[0]*e+t[4]*i+t[8]*s+t[12])/r,(t[1]*e+t[5]*i+t[9]*s+t[13])/r,(t[2]*e+t[6]*i+t[10]*s+t[14])/r)}};let D=T;o(D,"make",A=>new T(A)),o(D,"orthoNO",(A,t,e,i,s,r)=>{let n=1/(A-t),h=1/(e-i),l=1/(s-r);return new T([-2*n,0,0,0,0,-2*h,0,0,0,0,2*l,0,(A+t)*n,(i+e)*h,(r+s)*l,1])}),o(D,"perspective",(A,t,e,i)=>{const s=Math.tan(Math.PI*.5-.5*A);let r=1/(e-i),n=[s/t,0,0,0,0,s,0,0,0,0,(e+i)*r,-1,0,0,e*i*r*2,0];return new T(n)}),o(D,"frustum",(A,t,e,i,s,r)=>{let n=[2*s/(i-e),0,0,0,0,2*s/(A-t),0,0,(i+e)/(i-e),(A+t)/(A-t),-(r+s)/(r-s),-1,0,0,-2*r*s/(r-s),0];return new T(n)}),o(D,"perspective_from_frust",(A,t,e,i)=>{let s=e*Math.tan(A*.5),r=s*2,n=t*r,h=-.5*n,l=h+n,u=s-r;return T.frustum(s,u,h,l,e,i)}),o(D,"lookAt",(A,t,e)=>{let i=A.sub(t).normalize,s=e.cross(i).normalize,r=i.cross(s).normalize;return T.make([...s.vs,0,...r.vs,0,...i.vs,0,...A.vs,1])}),o(D,"from_quat",A=>{let[t,e,i,s]=A.out,r=t+t,n=e+e,h=i+i,l=t*r,u=e*r,c=e*n,d=i*r,m=i*n,_=i*h,f=s*r,y=s*n,p=s*h;return T.make([1-c-_,u+p,d-y,0,u-p,1-l-_,m+f,0,d+y,m-f,1-l-c,0,0,0,0,1])});const Q=class{constructor(A){this.out=A}static get identity(){return Q.make([0,0,0,1])}get mat4(){return D.from_quat(this)}set x(A){this.out[0]=A}set y(A){this.out[1]=A}set z(A){this.out[2]=A}set w(A){this.out[3]=A}get x(){return this.out[0]}get y(){return this.out[1]}get z(){return this.out[2]}get w(){return this.out[3]}get normalize(){let[A,t,e,i]=this.out,s=A*A+t*t+e*e+i*i;return s>0&&(s=1/Math.sqrt(s)),new Q([A*s,t*s,e*s,i*s])}get clone(){return new Q(this.out.slice(0))}get conjugate(){return new Q([-this.x,-this.y,-this.z,this.w])}get inverse(){let[A,t,e,i]=this.out,s=A*A+t*t+e*e+i*i,r=s?1/s:0;return new Q([-A*r,-t*r,-e*r,i*r])}set_in(A,t,e,i){let s=this.out;s[0]=A,s[1]=t,s[2]=e,s[3]=i}rotateX(A){let{clone:t}=this;return t.rotateX_in(A)}rotateX_in(A){A*=.5;let t=this.out,e=Math.sin(A),i=Math.cos(A),[s,r,n,h]=t;return t[0]=s*i+h*e,t[1]=r*i+n*e,t[2]=n*i-r*e,t[3]=h*i-s*e,this}rotateY(A){let{clone:t}=this;return t.rotateY_in(A)}rotateY_in(A){A*=.5;let t=this.out,e=Math.sin(A),i=Math.cos(A),[s,r,n,h]=t;return t[0]=s*i-n*e,t[1]=r*i+h*e,t[2]=n*i+s*e,t[3]=h*i-r*e,this}rotateZ(A){let{clone:t}=this;return t.rotateZ_in(A)}rotateZ_in(A){A*=.5;let t=this.out,e=Math.sin(A),i=Math.cos(A),[s,r,n,h]=t;return t[0]=s*i+r*e,t[1]=r*i-s*e,t[2]=n*i+h*e,t[3]=h*i-n*e,this}mul(A){let t=this.out,[e,i,s,r]=t,[n,h,l,u]=A.out;return t[0]=e*u+r*n+i*l-s*h,t[1]=i*u+r*h+s*n-e*l,t[2]=s*u+r*l+e*h-i*n,t[3]=r*u-e*n-i*h-s*l,this}mVec3(A){let[t,e,i,s]=this.out,{x:r,y:n,z:h}=A,l=e*h-i*n,u=i*r-t*h,c=t*n-e*r,d=e*c-i*u,m=i*l-t*c,_=t*u-e*l,f=s*2;return l*=f,u*=f,c*=f,d*=2,m*=2,_*=2,new C(r+l+d,n+u+m,h+c+_)}};let AA=Q;o(AA,"make",A=>new Q(A));const x=class{constructor(A,t){o(this,"x");o(this,"y");this.x=A,this.y=t}get key(){return[this.x,this.y].join(";")}static get unit(){return new x(1,1)}static get zero(){return new x(0,0)}static get left(){return new x(-1,0)}static get right(){return new x(1,0)}static get up(){return new x(0,-1)}static get down(){return new x(0,1)}get sign(){return x.make(Math.sign(this.x),Math.sign(this.y))}get floor(){return x.make(Math.floor(this.x),Math.floor(this.y))}get neighbours(){return[x.up,x.down,x.left,x.right].map(A=>A.add(this))}get right(){return x.right.add(this)}get left(){return x.left.add(this)}get up(){return x.up.add(this)}get down(){return x.down.add(this)}get vs(){return[this.x,this.y]}get mul_inverse(){return new x(1/this.x,1/this.y)}get inverse(){return new x(-this.x,-this.y)}get half(){return new x(this.x/2,this.y/2)}get length_squared(){return this.x*this.x+this.y*this.y}get length(){return Math.sqrt(this.length_squared)}get normalize(){if(this.length!==0)return this.scale(1/this.length)}get perpendicular(){return new x(-this.y,this.x)}get clone(){return new x(this.x,this.y)}get angle(){return Math.atan2(this.y,this.x)}dot(A){return this.x*A.x+this.y*A.y}cross(A){return this.x*A.y-this.y*A.x}project_to(A){let t=A.length_squared,e=this.dot(A);return x.make(e*A.x/t,e*A.y/t)}distance(A){return this.sub(A).length}addy(A){return x.make(this.x,this.y+A)}add_angle(A){return x.from_angle(this.angle+A)}scale(A){let{clone:t}=this;return t.scale_in(A)}scale_in(A){return this.x*=A,this.y*=A,this}add(A){let{clone:t}=this;return t.add_in(A)}add_in(A){return this.x+=A.x,this.y+=A.y,this}sub(A){let{clone:t}=this;return t.sub_in(A)}sub_in(A){return this.x-=A.x,this.y-=A.y,this}mul(A){let{clone:t}=this;return t.mul_in(A)}mul_in(A){return this.x*=A.x,this.y*=A.y,this}div(A){let{clone:t}=this;return t.div_in(A)}div_in(A){return this.x/=A.x,this.y/=A.y,this}set_in(A,t=this.y){return this.x=A,this.y=t,this}};let g=x;o(g,"from_key",A=>new x(parseFloat(A.split(";")[0]),parseFloat(A.split(";")[1]))),o(g,"from_angle",A=>new x(Math.cos(A),Math.sin(A))),o(g,"make",(A,t)=>new x(A,t));const Y=class{constructor(A,t,e,i,s,r){o(this,"array_t");o(this,"a");o(this,"b");o(this,"c");o(this,"d");o(this,"tx");o(this,"ty");this.a=A,this.b=t,this.c=e,this.d=i,this.tx=s,this.ty=r,this.array_t=new Float32Array([A,t,0,e,i,0,s,r,1])}static get identity(){return new Y(1,0,0,1,0,0)}static get unit(){return Y.identity}get clone(){let{a:A,b:t,c:e,d:i,tx:s,ty:r}=this;return new Y(A,t,e,i,s,r)}get inverse(){let{a:A,b:t,c:e,d:i,tx:s,ty:r}=this,n=A*i-t*e,h=i/n,l=-t/n,u=-e/n,c=A/n,d=(e*r-i*s)/n,m=-(A*r-t*s)/n;return new Y(h,l,u,c,d,m)}rotate_in(A){let t=Math.cos(A),e=Math.sin(A),i=this.a*t-this.b*e,s=this.a*e+this.b*t,r=this.c*t-this.d*e,n=this.c*e+this.d*t,h=this.tx*t-this.ty*e,l=this.tx*e+this.ty*t;return this.a=i,this.b=s,this.c=r,this.d=n,this.tx=h,this.ty=l,this}rotate(A){let{clone:t}=this;return t.rotate_in(A),t}scale(A,t){let e=this.a*A,i=this.b,s=this.c,r=this.d*t,n=this.tx,h=this.ty;return new Y(e,i,s,r,n,h)}translate_in(A,t){this.a,this.b,this.c,this.d;let e=A+this.tx,i=t+this.ty;return this.tx=e,this.ty=i,this}translate(A,t){let{clone:e}=this;return e.translate_in(A,t),e}scale_in(A,t){return this.a=A,this.d=t,this}mVec2(A){let t=this.a,e=this.b,i=this.c,s=this.d,r=this.tx,n=this.ty,h=t*A.x+i*A.y+r,l=e*A.x+s*A.y+n;return g.make(h,l)}mul_in(A){let{a:t,b:e,c:i,d:s,tx:r,ty:n}=this;this.a=A.a*t+A.b*i,this.b=A.a*e+A.b*s,this.c=A.c*t+A.d*i,this.d=A.c*e+A.d*s,this.tx=A.tx*t+A.ty*i+r,this.ty=A.tx*e+A.ty*s+n}set_in(A){let{a:t,b:e,c:i,d:s,tx:r,ty:n}=A;this.a=t,this.b=e,this.c=i,this.d=s,this.tx=r,this.ty=n}transform_in(A,t,e,i=g.unit.half){this.a=Math.cos(t)*A.x,this.b=Math.sin(t)*A.x,this.c=-Math.sin(t)*A.y,this.d=Math.cos(t)*A.y,this.tx=e.x-(i.x*this.a+i.y*this.c),this.ty=e.y-(i.x*this.b+i.y*this.d)}};let tA=Y;o(tA,"projection",(A,t)=>{let e=0,i=0,s=1/A*2,r=-1/t*2,n=-1,h=1;return new Y(s,e,i,r,n,h)});const H=class{constructor(A){this.vertices=A}static get unit(){return H.make(0,0,1,1)}get vs(){let{x:A,y:t,w:e,h:i}=this;return[A,t,e,i]}get x1(){return this.vertices[0].x}get y1(){return this.vertices[0].y}get x2(){return this.vertices[2].x}get y2(){return this.vertices[2].y}get x(){return this.x1}get y(){return this.y1}get w(){return this.x2-this.x1}get h(){return this.y2-this.y1}get center(){return g.make(this.x+this.w/2,this.y+this.h/2)}get vertexData(){return new Float32Array(this.vertices.flatMap(A=>A.vs))}get indices(){return new Uint16Array([0,1,2,0,2,3])}larger(A){return H.make(this.x-A/2,this.y-A/2,this.w+A,this.h+A)}transform(A){return new H(this.vertices.map(t=>A.mVec2(t)))}};let eA=H;o(eA,"make",(A,t,e,i)=>new H([g.make(A,t),g.make(A+e,t),g.make(A+e,t+i),g.make(A,t+i)]));const _A=class{constructor(A,t,e){o(this,"fsUv");o(this,"frame");this.tw=A,this.th=t,this._frame=e,this.frame=e.transform(tA.unit.scale(1/this.tw,1/this.th)),this.fsUv=new Float32Array([this.x0,this.y0,this.x1,this.y1,this.x2,this.y2,this.x3,this.y3])}get w(){return this._frame.w}get h(){return this._frame.h}get x0(){return this.frame.x}get y0(){return this.frame.y}get x1(){return this.frame.x2}get y1(){return this.y0}get x2(){return this.x1}get y2(){return this.frame.y2}get x3(){return this.x0}get y3(){return this.y2}};let iA=_A;o(iA,"make",(A,t,e,i,s,r)=>new _A(A,t,eA.make(e,i,s,r)));class XA{constructor(A){o(this,"nb",24e3);o(this,"_els",[]);o(this,"_indexBuffer",new Uint16Array(this.nb*3));o(this,"_attributeBuffer",new Float32Array(this.nb*9));o(this,"_def");o(this,"_def2");o(this,"u_blend",[.1,2.5,.5,.5]);this.g=A}init(A,t){let{g:e,nb:i}=this;this._def=e.glProgram(fA,GA,i),this._def2=e.glProgram(fA,NA,i),e.glOnce({color:A});let{glTexture:s}=e.glTexture(0);e.glUseTexture(s,t[0],0);let{glTexture:r}=e.glTexture(1);e.glUseTexture(r,t[1],1);let{glTexture:n}=e.glTexture(2);e.glUseTexture(n,t[2],2)}texture(A,t,e,i,s,r,n,h,l,u,c,d,m,_,f){let y=AA.identity.rotateX(t).rotateY(e).rotateZ(i),p=D.identity.translate(C.make(s,r,n)).rotate(y).scale(C.make(h,l,0)).translate(C.make(-1/2,1/2,0)),v=iA.make(_,f,u,c,d,m);this._els.push([A===13421772?this._def2:0,p,A,v,-1,f])}render(){var l;let{g:A}=this,{_indexBuffer:t,_attributeBuffer:e}=this,{u_blend:i}=this;A.glClear();let s=(l=this._els[0])==null?void 0:l[0],r=0,n=0,h=0;this._els.forEach((u,c)=>{var U;let[d,m,_,f,y,p]=u,v=$.unit.transform(m),{vertexData:E,indices:z}=v,{fsUv:M}=f,B=kA(_);for(let b=0;b<E.length;b+=3)e[n++]=E[b],e[n++]=E[b+1],e[n++]=E[b+2],e[n++]=M[2*b/3],e[n++]=M[2*b/3+1],e[n++]=B[0],e[n++]=B[1],e[n++]=B[2],e[n++]=y,e[n++]=p;for(let b=0;b<z.length;b++)t[h++]=r*4+z[b];if(!this._els[c+1]||this._els[c+1][0]!==s){s=(U=this._els[c+1])==null?void 0:U[0];let{program:b,uniformData:R,indexBuffer:P,attributeBuffer:F,vao:I}=d||this._def;A.glUse(b,R),A.glAttribUpdate(F,e),A.glIndexUpdate(P,t),A.glUniformUpdate(R,i),A.glDraw(h,I),n=0,h=0,r=0}else r++}),this._els=[]}}class qA{constructor(A,t){o(this,"p_matrix",D.orthoNO(0,1080,1920,0,-10,100));this.o=A,this.l=t}get v_matrix(){return this.c_matrix.inverse||D.identity}get vp_matrix(){return this.p_matrix.mul(this.v_matrix)}get c_matrix(){return D.lookAt(this.o,this.l,C.up)}}const gA=class{constructor(A){o(this,"_bounds");this.$_=A}$clear_bounds(){this._bounds=void 0}get bounds(){return this._bounds||(this._bounds=this.$_.getBoundingClientRect()),this._bounds}get size(){let{bounds:A}=this;return g.make(A.width,A.height)}get orig(){let{bounds:A}=this;return g.make(A.x,A.y)}get_normal_at_abs_pos(A){let{orig:t,size:e}=this;return A.sub(t).div(e)}};let j=gA;o(j,"make",A=>new gA(A));const EA=a=>{document.addEventListener("scroll",a,{capture:!0,passive:!0}),window.addEventListener("resize",a,{passive:!0})};function HA(a){var A;return a.clientX!==void 0&&a.clientY!==void 0?[a.clientX,a.clientY]:(A=a.targetTouches)!=null&&A[0]?[a.targetTouches[0].clientX,a.targetTouches[0].clientY]:[0,0]}class TA{}o(TA,"init",(A,t=document)=>{const e=_=>{let f=HA(_);return f?g.make(f[0],f[1]):g.zero};let{_onDragStart:i,_onDragMove:s,_onDragEnd:r,_onContextMenu:n,_onWheel:h}=A;const l=_=>{i==null||i(e(_),_.buttons===2||_.button===2)},u=_=>{s==null||s(e(_))},c=_=>{r==null||r(e(_))},d=_=>{n&&(_.preventDefault(),n())},m=_=>{h==null||h(Math.sign(_.deltaY))};return t.addEventListener("wheel",m),t.addEventListener("touchstart",l,{passive:!1}),t.addEventListener("mousedown",l,{passive:!1}),t.addEventListener("contextmenu",d),document.addEventListener("mousemove",u,{passive:!1}),document.addEventListener("mouseup",c),document.addEventListener("touchmove",u,{passive:!1}),document.addEventListener("touchend",c),()=>{t.removeEventListener("wheel",m),t.removeEventListener("touchstart",l),t.removeEventListener("mousedown",l),t.removeEventListener("contextmenu",d),document.removeEventListener("mousemove",u),document.removeEventListener("mouseup",c),document.removeEventListener("touchmove",u),document.removeEventListener("touchend",c)}});const jA=(a,A)=>{let{on_hover:t,on_up:e,on_click:i,on_drag:s,on_context:r}=a,n,h,l,u;const c=d=>d&&{...d};return TA.init({...r?{_onContextMenu(){r==null||r()}}:{},_onDragStart(d,m){h=c(n),n={e:d,_right:m},u&&(u==null||u()),u=vA(_=>{n?((n.m||l&&n.e.distance(l)>3)&&(n.m=l),s==null||s(n,h),h=c(n)):u==null||u()})},_onDragMove(d){l=d,n||t==null||t(d)},_onDragEnd(){!n||(n.m||i==null||i(n.e,n._right),e==null||e(n.m||n.e,n._right),u==null||u(),u=void 0,n=void 0,l=void 0)}},A)},rA=class{constructor(A,t,e=0){o(this,"_completed");o(this,"_i");o(this,"_t");o(this,"_value");this._values=A,this._durations=t,this.loop=e}get value(){return this._value}get i(){let A=this._durations[this._i%this._durations.length];return Math.min(this._t/A,1)}get completed(){return this._completed}complete_now(){this._value=this._values[this._values.length-1],this._completed=!0}update(A){if(this._completed)return;let{_values:t}=this;this._t+=A;let e=t[this._i],i=t[this._i+1],s=this.i;this._value=VA(e,i,KA(s)),s===1&&(this._i++,this._t=0,this._i>=t.length-1&&(this.loop===1?(this._i=0,this._values.reverse(),this._durations.reverse()):this._completed=!0))}init(){return this._i=0,this._t=0,this._completed=!1,this._value=this._values[0],this}};let O=rA;o(O,"make_from_settings",A=>rA.make(A.values,A.duration,A.loop)),o(O,"make",(A,t,e=!1)=>new rA(A.slice(0),[t],e?1:0).init());function KA(a){return a<.5?2*a*a:-1+(4-2*a)*a}const VA=(a,A,t=.5)=>a*(1-t)+A*t;class L{constructor(A,t,e){this.x=A,this.y=t,this.z=e}dot2(A,t){return this.x*A+this.y*t}dot3(A,t,e){return this.x*A+this.y*t+this.z*e}}const WA=[new L(1,1,0),new L(-1,1,0),new L(1,-1,0),new L(-1,-1,0),new L(1,0,1),new L(-1,0,1),new L(1,0,-1),new L(-1,0,-1),new L(0,1,1),new L(0,-1,1),new L(0,1,-1),new L(0,-1,-1)],xA=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],X=new Array(512),q=new Array(512),JA=function(a){a>0&&a<1&&(a*=65536),a=Math.floor(a),a<256&&(a|=a<<8);for(var A=0;A<256;A++){var t;A&1?t=xA[A]^a&255:t=xA[A]^a>>8&255,X[A]=X[A+256]=t,q[A]=q[A+256]=WA[t%12]}};JA(0);function yA(a){return a*a*a*(a*(a*6-15)+10)}function oA(a,A,t){return(1-t)*a+t*A}const bA=function(a,A){var t=Math.floor(a),e=Math.floor(A);a=a-t,A=A-e,t=t&255,e=e&255;var i=q[t+X[e]].dot2(a,A),s=q[t+X[e+1]].dot2(a,A-1),r=q[t+1+X[e]].dot2(a-1,A),n=q[t+1+X[e+1]].dot2(a-1,A-1),h=yA(a);return oA(oA(i,r,h),oA(s,n,h),yA(A))};class cA{constructor(A,t,e,i=G.half){o(this,"_life");o(this,"value");o(this,"_fade");this._max=A,this._speed=t,this._direction=e,this._max_fade=i,this._life=0,this.value=g.zero,this._fade=this._max_fade}get x(){return this.value.x}get y(){return this.value.y}get completed(){return this._fade===0}_update(A){this._life+=A,this._fade>0&&(this._fade-=A,this._fade<0&&(this._fade=0));let t=Math.sin(this._speed*this._life),e=this._direction.add(g.make(bA(Math.cos(this._life),Math.sin(this._life)),bA(Math.sin(this._life),Math.cos(this._life))).scale(2)),i=this._fade/this._max_fade;this.value=e.scale(t*this._max*i)}}class aA{constructor(A,t){o(this,"_next_state",this);this.drag_piece=A,this.o=t}get _is_down(){return this.drag_piece._is_down}get hooks(){return this.drag_piece.hooks}init(){return this.hooks.on_begin(this._type,this.o),this._init(),this}_init(){}_drag_end(){}_drag_move(A){}_update(A){}}class ZA extends aA{constructor(t){super(t.drag_piece,t.o);o(this,"_type","slide-pass");o(this,"_tween");this._drag_test=t}get _drag_begin(){return this._drag_test._drag_begin}_init(){this._tween=O.make([.3,.8,1,1],G.five)}_update(t){if(this._tween.update(t),this._tween.completed)this.hooks.on_pass(),this._is_down?this._next_state=new CA(this._drag_begin).init():this._next_state=void 0;else{let e=100*Math.sign(this._drag_begin._h)*this._tween.value,i=100*Math.sign(this._drag_begin._v)*this._tween.value;e=Math.max(-100,Math.min(100,e)),i=Math.max(-100,Math.min(100,i)),this.hooks.on_move(e,i)}}}class $A extends aA{constructor(t){super(t.drag_piece,t.o);o(this,"_type","slide-fail");o(this,"_shake");o(this,"_tween");this._drag_test=t}get _drag_begin(){return this._drag_test._drag_begin}_init(){this._shake=new cA(3,1,g.left,G.sixth),this._tween=O.make([1,1,0],G.sixth)}_update(t){if(this._shake._update(t),this._tween.update(t),this._shake.completed||this.hooks.on_shake(this._shake),this._tween.completed)this._next_state=void 0;else{let e=this._drag_begin._h*this._tween.value,i=this._drag_begin._v*this._tween.value;e=Math.max(-30,Math.min(30,e)),i=Math.max(-30,Math.min(30,i)),this.hooks.on_move(e,i)}}}class CA extends aA{constructor(t){super(t.drag_piece,t.o);o(this,"_type","slide-test");o(this,"_tween");this._drag_begin=t}_drag_end(){}_init(){this._tween=O.make([0,1],G.five)}_update(t){this._tween.update(t);let e=this._drag_begin._h*this._tween.value,i=this._drag_begin._v*this._tween.value;e=Math.max(-30,Math.min(30,e)),i=Math.max(-30,Math.min(30,i)),this.hooks.on_move(e,i),this._tween.completed&&(this.hooks.on_test_move_(g.make(this._drag_begin._h,this._drag_begin._v).sign)?this._next_state=new ZA(this).init():this._next_state=new $A(this).init())}}class At extends aA{constructor(){super(...arguments);o(this,"_v");o(this,"_h");o(this,"_type","begin");o(this,"_shake")}_drag_move(t){let e=this.o.sub(t),i=e.dot(g.left),s=e.dot(g.up),r=Math.abs(i),n=Math.abs(s);r>n?(this._shake||(this._shake=new cA(1,1,g.left.scale(2*Math.sign(i)),G.three)),this._h=i,this._v=0):(this._shake||(this._shake=new cA(1,1,g.up.scale(2*Math.sign(s)),G.three)),this._v=s,this._h=0)}_update(t){this._shake&&(this._shake._update(t),this._shake.completed&&(this._next_state=new CA(this).init()),this.hooks.on_shake(this._shake))}}let tt=g.make(1080,1920),wA=tt.scale(1),pA=g.make(540,740).sub(g.make(500,500));class et{constructor(A,t){o(this,"_is_down");o(this,"_state");this.element=A,this.hooks=t;let e=j.make(A);EA(()=>{e.$clear_bounds()}),this._is_down=!1;let i=this;jA({on_context(){},on_drag(s,r){if(s.m){i._is_down=!0;let n=e.get_normal_at_abs_pos(s.e).mul(wA).sub(pA),h=e.get_normal_at_abs_pos(s.m).mul(wA).sub(pA);if(i._state)i._state._drag_move(h);else{let l=h.scale(.01).floor;t.on_test_drag(l)&&(i._state=new At(i,n).init())}}},on_up(){i._is_down=!1}},A)}_update(A){this._state&&(this._state._update(A),this._state=this._state._next_state,this._state||this.hooks.on_end())}}class dA{constructor(A,t,e=new Map,i=new Map){this.w=A,this.h=t,this._map=e,this._o_by_body=i}get clone(){return new dA(this.w,this.h,new Map(this._map),new Map(this._o_by_body))}get bodies(){return[...this._o_by_body].map(([A,t])=>[A,A.map(e=>e.add(t))])}move_(A,t){if(!this._w_body(t).map(i=>A.add(i)).find(i=>{let s=this.on(i);return s&&s!==t})){let i=this._o_by_body.get(t),{clone:s}=this;return s.remove_body(t),s.body(i.add(A),t),s}}_w_body(A){let t=this._o_by_body.get(A);return A.map(e=>e.add(t))}on(A){return this._map.get(A.key)}remove_body(A){let t=this._o_by_body.get(A);A.forEach(e=>this._map.delete(t.add(e).key)),this._o_by_body.delete(A)}body(A,t){let e=t.map(i=>i.add(A)).map(i=>[i.key,t]);return e.forEach(([i,s])=>this._map.set(i,s)),this._o_by_body.set(t,A),e.map(i=>g.from_key(i[0]))}}const it={"#":[g.zero],o:[g.zero],n:[g.zero,g.zero.right],l:[g.zero,g.zero.down],g:[g.zero,g.zero.right,g.zero.down,g.zero.right.down]},nA=class{constructor(A,t){this.grid=A,this.info_by_body=t}get bodies(){return this.grid.bodies.map(([A,t])=>[this.info_by_body.get(A),t])}with_grid(A){let t=new Map([...this.info_by_body].map(([e,i])=>[e,{...i,o:A._o_by_body.get(e)}]));return new nA(A,t)}};let sA=nA;o(sA,"from_fen",A=>{var h;let t=0,e=0,i=new Map;A.split(`
`).forEach((l,u)=>{t=u+1,l.split("").forEach((c,d)=>{e=d+1,i.set(g.make(d,u).key,c)})});let s=new dA(t,e),r=new Map,n=[];for(let[l,u]of i){if(n.includes(l))continue;let c=g.from_key(l),d=(h=it[u])==null?void 0:h.slice(0);if(!d)continue;s.body(c,d).forEach(_=>n.push(_.key)),r.set(d,{body:d,o:c,char:u})}return new nA(s,r)});let lA=g.make(540,740).sub(g.make(500,500));g.make(1080,1920);function st(a,A){a.splice(a.indexOf(A),1)}const rt=(a,A,t)=>Math.floor(t/a)!==Math.floor(A/a);class nt{constructor(A){o(this,"data");o(this,"life");o(this,"life0");this.ctx=A}get ref(){return this.ctx.ref}get c(){return this.ctx.c}get g(){return this.ctx.g}_set_data(A){return this.data=A,this}init(){return this.life=0,this.life0=0,this._init(),this}update(A){this.life0=this.life,this.life+=A,this._update(A)}draw(){this._draw()}on_interval(A){return rt(A,this.life,this.life0)}between_interval(A){return this.life%(A*2)>A}}class BA extends nt{constructor(){super(...arguments);o(this,"z");o(this,"objects");o(this,"makes")}make(t,e={},i=0,s=1){this.makes.push([t,e,i,s,0,0])}init(){return this.objects=[],this.makes=[],this.z=0,super.init()}update(t){let{makes:e}=this;this.makes=[],this.makes=this.makes.concat(e.filter(i=>{var m;i[4]+=t;let[s,r,n,h,l,u]=i,c=h<0,d=Math.abs(h);if(l>=n){do new s(this)._set_data({group:this.objects,...((m=r.apply)==null?void 0:m.call(r,i[5],i[4],d,n))||r}).init();while(++i[5]<d&&c);return i[4]=0,d===0||i[5]<d}else return!0})),super.update(t)}_init(){}_update(t){}_draw(){}}class at extends BA{constructor(t){super(t.ctx);o(this,"on_dispose");o(this,"_alive");this.plays=t,this.on_dispose=[]}make(t,e={},i=0,s=1){this.plays.make(t,e,i,s)}get alive(){return this._alive}init(){let{group:t}=this.data;return t&&(t.push(this),this._alive=!0),super.init()}dispose(t){let{group:e}=this.data;e&&(st(e,this),this._alive=!1),this.on_dispose.forEach(i=>i(this,t)),this._dispose(t)}_dispose(t){}}let ht=`
# ########
  #nno.o.#
  #logglo#
  #logglo#
  ###.####
`;class ot extends at{constructor(){super(...arguments);o(this,"_drag_body");o(this,"_drag_o");o(this,"_drag_shake");o(this,"_drag_move");o(this,"_drag_move_grid");o(this,"_drag");o(this,"grid");o(this,"_ok",!1)}_init(){let t=this;t.grid=sA.from_fen(ht.trim()),t._drag=new et(this.ref.$_,{on_pass(){t._drag_move_grid&&(t._drag_move=g.zero,t.grid=t.grid.with_grid(t._drag_move_grid),t._pass_check())},on_test_move_(e){return t._drag_move_grid=t.grid.grid.move_(e,t._drag_body),!!t._drag_move_grid},on_test_drag(e){return t._drag_body=t.grid.grid.on(e),!!t._drag_body},on_begin(e,i){t._drag_o=i},on_move(e,i){t._drag_move=g.make(e,i)},on_shake(e){t._drag_shake=e},on_end(){t._drag_body=void 0,t._drag_o=void 0,t._drag_shake=void 0,t._drag_move=void 0}})}_pass_check(){this._ok||this.grid.bodies.forEach(([t,e])=>{t.char==="n"&&t.o.key===g.make(7,1).key&&(this._ok=!0,alert("you win"))})}_update(t){this._drag._update(t)}_draw(){var i,s,r,n,h;this.g.texture(13421772,0,0,0,540,740,-80,1e3,1e3,384,16,1,1,2048,2048);let t=lA.x+7*100,e=lA.y+1*100;if(this.g.texture(13421772,0,0,0,t+50,e+50,-80,100,100,288,32,32,32,2048,2048),t+=100,this.g.texture(13421772,0,0,0,t+50,e+50,-80,100,100,288,32,32,32,2048,2048),this.grid.bodies.forEach(([l,u])=>{if(l.body===this._drag_body)return;let c=40+50+l.o.x*100,d=240+50+l.o.y*100;switch(l.char){case"#":this.g.texture(13421772,0,0,0,c,d,-80,100,100,16,80,32,32,2048,2048);break;case"o":this.g.texture(13421772,0,0,0,c,d,-80,100,100,16,32,32,32,2048,2048);break;case"l":this.g.texture(13421772,0,0,0,c,d+50,-80,100,200,64,32,32,64,2048,2048);break;case"n":this.g.texture(13421772,0,0,0,c+50,d,-80,200,100,112,32,64,32,2048,2048);break;case"g":this.g.texture(13421772,0,0,0,c+50,d+50,-80,200,200,192,32,64,64,2048,2048);break}}),this._drag_body){let[l,u]=this.grid.bodies.find(v=>v[0].body===this._drag_body),c=(((i=this._drag_shake)==null?void 0:i.x)||0)/100*Math.PI,d=((s=this._drag_shake)==null?void 0:s.x)||0,m=((r=this._drag_shake)==null?void 0:r.y)||0;d+=((n=this._drag_move)==null?void 0:n.x)||0,m+=((h=this._drag_move)==null?void 0:h.y)||0;let _=4,f=l.o.scale(100).add(lA).add(g.make(50,50)),y=f.x+d-_/2,p=f.y+m-_/2;switch(l.char){case"#":this.g.texture(13421772,0,0,c,y,p,-80,100+_,100+_,16,80,32,32,2048,2048);break;case"o":this.g.texture(13421772,0,0,c,y,p,-80,100+_,100+_,16,32,32,32,2048,2048);break;case"l":this.g.texture(13421772,0,0,c,y,p+50,-80,100+_,200+_,64,32,32,64,2048,2048);break;case"n":this.g.texture(13421772,0,0,c,y+50,p,-80,200+_,100+_,112,32,64,32,2048,2048);break;case"g":this.g.texture(13421772,0,0,c,y+50,p+50,-80,200+_,200+_,192,32,64,64,2048,2048);break}}}}class lt extends BA{constructor(){super(...arguments);o(this,"ui")}all(t){return this.objects.filter(e=>e instanceof t)}one(t,e=this.objects){return e.findLast(i=>i instanceof t)}tag(t,e,i=this.objects){return i.find(s=>s instanceof t&&s.data.tag===e)}get z_objects(){return this.objects.sort((t,e)=>e.z-t.z)}get audio(){return this.one(Audio)}_init(){this.objects=[],this.ui=[],this.make(ot)}_update(t){this.objects.forEach(e=>e.update(t))}_draw(){this.g.texture(13421772,0,0,0,1080/2,1920/2,-90,1080,1920,400,16,1,1,2048,2048),this.z_objects.forEach(t=>t.draw())}}function ut(a,A){let t=new qA(C.zero,C.zero),e=new RA(a,MA,UA),i=new OA(e,t),s=new XA(i),r=j.make(a);EA(()=>{r.$clear_bounds()});let n={c:t,g:s,ref:r},h=new lt(n).init();s.init(0,A),vA(l=>{h.update(l),h.draw(),s.render()})}function uA(a){return new Promise(A=>{let t=new Image;t.onload=()=>A(t),t.src=a})}const ct=a=>{Promise.all([uA(hA),uA(hA),uA(hA)]).then(A=>ut(a,A))};ct(document.getElementById("app"));
